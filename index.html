<!DOCTYPE html>
<html>
<head>
    <title>
        Canvas Render
    </title>

    <link rel="stylesheet" type="text/css" href="src/css/home.css">

    <script type="text/javascript" src="src/packages/jquery/dist/jquery.js"></script>
    <script type="text/javascript" src="src/packages/stats.js/build/stats.min.js"></script>
    <script type="text/javascript" src="src/packages/linq-js/dist/linq.js"></script>
    <script type="text/javascript" src="src/js/lib/StackBlur.js"></script>

    <script type="text/javascript" src="src/js/modules/utility/linkedlist.js"></script>
    <script type="text/javascript" src="src/js/modules/utility/eventmanager.js"></script>
    <script type="text/javascript" src="src/js/modules/utility/general.js"></script>
    <script type="text/javascript" src="src/js/modules/utility/graphics.js"></script>
    <script type="text/javascript" src="src/js/modules/stage.js"></script>
    <script type="text/javascript" src="src/js/modules/layer.js"></script>
    <script type="text/javascript" src="src/js/modules/vector.js"></script>
    <script type="text/javascript" src="src/js/modules/filters.js"></script>
    <script type="text/javascript" src="src/js/modules/transition.js"></script>
    <script type="text/javascript" src="src/js/modules/object.js"></script>
    <script type="text/javascript" src="src/js/modules/shapes/line.js"></script>
    <script type="text/javascript" src="src/js/modules/shapes/image.js"></script>
    <script type="text/javascript" src="src/js/modules/shapes/arc.js"></script>
    <script type="text/javascript" src="src/js/modules/shapes/rectangle.js"></script>
    <script type="text/javascript" src="src/js/modules/shapes/sprite.js"></script>
    <script type="text/javascript" src="src/js/modules/shapes/polygon.js"></script>
    <script type="text/javascript" src="src/js/modules/animation.js"></script>
    <script type="text/javascript" src="src/js/modules/game/physics.js"></script>
    <script type="text/javascript" src="src/js/modules/game/polygonCollision.js"></script>
</head>
<body>
<div style="display: inline-block;" id="viewport">
</div>
<div style="display: inline-block; vertical-align: top;" id="stats">
    <span>FPS:</span><span id="fps"></span>
</div>
<script>
    function sprite(layer) {
        var test = new RenderJs.Canvas.Shapes.Sprite({
            url: "src/images/ship-sprite.png",
            x: 100,
            y: 100,
            angle: 0,
            collision: false,
            defAnimation: "idle",
            animations: {
                idle: [
                    [0, 0, 52, 44]
                ],
                move: [
                    [52, 0, 52, 84],
                    [104, 0, 52, 84],
                    [156, 0, 52, 84],
                    [208, 0, 52, 84]
                ]
            },
            frameCount: 6
        });
        layer.addObject(test);
        test.start();
        return test;
    }

    var stage = new RenderJs.Canvas.Stage({
        container: "viewport",
        width: 1200,
        height: 800
    });
    var animlayer = stage.createLayer(true);
    var spriteObj = sprite(animlayer);
    var a = 0;
    var angle = 0;
    var frict = 0;
    animlayer.on(RenderJs.Canvas.Events.keydown, function (event) {
        switch (event.keyCode) {
            case 38:
                frict = 0;
                a = -0.5;
                spriteObj.setAnimation("move", true);
                break;
            case 40:
                frict = 0;
                a = 0.5;
                spriteObj.setAnimation("move", true);
                break;
            case 37:
                angle = -0.25;
                break;
            case 39:
                angle = 0.25;
                break;
        }
    });

    animlayer.on(RenderJs.Canvas.Events.keyup, function (event) {
        if (event.keyCode === 38 || event.keyCode === 40) {
            if (event.keyCode === 38)
                frict = -0.005;
            else
                frict = 0.005;
            spriteObj.setAnimation("idle", true);
        }
        if (event.keyCode === 37 || event.keyCode === 39) {
            angle = 0;
        }
    });
    var anim = new RenderJs.Canvas.Animation(function (frameData) {
        if ((a > 0 && frict < 0) || (a < 0 && frict > 0)) {
            a = 0;
            frict = 0;
        }
        else {
            a -= frict;
        }
        spriteObj.angle += (angle * (frameData.time - frameData.lastTime));
        spriteObj.pos.x += (a * (frameData.time - frameData.lastTime)) * Math.sin(Utils.convertToRad(spriteObj.angle * -1));
        spriteObj.pos.y += (a * (frameData.time - frameData.lastTime)) * Math.cos(Utils.convertToRad(spriteObj.angle * -1));
    }, animlayer);
    anim.start();

</script>
</body>
</html>